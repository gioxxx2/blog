---
title: iOS调试
date: 2019-01-31 15:25:25
categories: iOS
tags: 
    - 调试
    - 汇编
    - Debug
---

本文主要介绍iOS调试相关的技术，在日常调试过程中，很有可能会遇到下文中的bug问题，却无法定位到问题和复现问题，特此记录下来。

<!--more-->

fix bug一定要fix在root cause上，了解一个问题，不但要知其然，还要知其所以然。如果遇到需要紧急修复的bug，可以先给一个hot fix去救火，然后，有时间去调查root cause，最后经过分析和测试，给出一个final 的 offical fix。

快速地fix bug，并不等于，不求甚解的fix bug。切记不可认同只要时间紧bug是可以乱fix的。

## Xcode数据断点

数据访问断点，简单来说，就是监控对内存的读写操作的断点。 当内存地址被访问或者被读取的时候，发生调试中断。

一般而言，数据断点属于硬件断点。即属于由cpu支持。这个和我们通常在调试器下的断点，有所不同。通常调试器下的断点，其实是替换断点处的指令为调试指令。（x86下int3， arm下trap）当代码执行到这里时，发生调试异常，通知调试器，继续运行的时候，还原指令，同时修改ip到还原的指令前。

### 跟踪全局变量

如果一个全局变量被多个模块使用，由于引用的地方很多，使用LLDB的watchpoint就可以很轻松的跟踪其值的变化，甚至断点在某一特定值下。

![屏幕快照 2019-01-31 下午4.28.25](/images/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-01-31%20%E4%B8%8B%E5%8D%884.28.25.png)


### 跟踪对象释放时机

有时候，我们新接手一个功能，需要了解一个对象到底在哪里被释放了，或者跟踪一个对象释放后使用，但代码太复杂，很难找到对象被释放的点。如果是我们自己的对象，我们可以在dealloc下下断点解决，但是如果对象很多，或者非我们对象呢？

   这个时候，需要结合zombine选项了。我们都知道，zombine选项勾选之后，访问被释放的对象时，会打印xx对象已被释放。同时抛出异常。很明显，zombine的实现方式，是对象释放时，不释放内存，并且修改对象的isa指针，指向新的zombine_xxx类型。基于此，我们可以很简单的设置一个数据断点。比如，obja 地址为0x123456  那么设置 watchpoint set expression 0x123456  .（如此设置断点地址，是因为isa指针为NSObject第一个元素） 当对象被释放，isa被修改的时候立即就会触发。可以第一时间找到释放点。





参考出处
<https://www.jianshu.com/p/e89af3e9a8d7>



